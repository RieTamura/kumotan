# v1.0.1 ベータフィードバック対応

**対応日**: 2026-01-15 〜 2026-01-19
**対応者**: Claude Code

## 概要

TestFlight配信後のベータテスターからのフィードバックに基づき、UIの改善を実施しました。

---

## 修正内容

### 1. WordPopupモーダルのキャンセルボタン透過問題

**報告内容**: ポップアップ画面のキャンセルボタンが透けている

**原因**：

1. アクションボタンエリアが`position: 'absolute'`で配置されていたが、`bottom: Spacing.xl`で隙間があった
2. キャンセルボタンの`outline`バリアントの`backgroundColor`が`'transparent'`（透明）だった
3. iOSのセーフエリア（ホームインジケーター）が未考慮だった

**修正ファイル**：

- `src/components/WordPopup/WordPopupModal.tsx`
- `src/components/common/Button.tsx`

**修正内容**：

**WordPopupModal.tsx** - アクションエリアのスタイル修正：
```typescript
// useSafeAreaInsetsをインポート
import { useSafeAreaInsets } from 'react-native-safe-area-context';

// コンポーネント内でセーフエリアを取得
const insets = useSafeAreaInsets();

// 動的にpaddingBottomを設定
<View style={[styles.actions, { paddingBottom: Math.max(insets.bottom, Spacing.lg) }]}>

// スタイル修正
actions: {
  flexDirection: 'row',
  paddingHorizontal: Spacing.xl,
  paddingTop: Spacing.lg,
  gap: Spacing.md,
  position: 'absolute',
  bottom: 0,  // Spacing.xl から 0 に変更
  left: 0,
  right: 0,
  backgroundColor: Colors.background,
  borderTopWidth: 1,  // 追加
  borderTopColor: Colors.divider,  // 追加
},

scrollContentContainer: {
  paddingBottom: 140,  // 100 から 140 に増加
},
```

2. **Button.tsx** - outlineバリアントの背景色修正:
```typescript
outline: {
  backgroundColor: Colors.background,  // 'transparent' から変更
  borderWidth: 1,
  borderColor: Colors.primary,
},
```

---

### 2. ライセンス画面のYahoo! API表示が縦書きになる問題

**報告内容**: Yahooのライセンス表示が縦書きになっている

**原因**： `licenseHeader`スタイルで`flexDirection: 'row'`を使用していた。`licenseName`が`flex: 1`で幅を取っていたため、長いテキストが縦に折り返されていた。

**修正ファイル**: `src/screens/LicenseScreen.tsx`

**修正内容**:
```typescript
licenseHeader: {
  flexDirection: 'column',  // 'row' から変更
  marginBottom: Spacing.xs,
  gap: Spacing.xs,
},
licenseName: {
  fontSize: FontSizes.md,
  fontWeight: '600',
  color: Colors.text,
  // flex: 1 を削除
},
licenseType: {
  // ... 既存のスタイル
  alignSelf: 'flex-start',  // 追加（バッジを左寄せ）
},
```

---

### 3. タブバーのラベル削除

**報告内容**: フッターメニューアイコン下の文字はいらないかも

**修正ファイル**: `src/navigation/AppNavigator.tsx`

**修正内容**:
- タブバーのラベル（「ホーム」「単語帳」「進捗」「設定」）を削除
- アイコンのみの表示に変更
- 不要になった`Text`、`FontSizes`インポートと`tabLabel`スタイルを削除
- `accessibilityLabel`はそのまま残し、スクリーンリーダーでのタブ名読み上げは維持

---

### 4. TOPへ戻るボタンの実装

**報告内容**: TOPへ戻るボタンを実装して欲しい

**修正ファイル**: `src/screens/HomeScreen.tsx`

**実装内容**:
- 500px以上スクロールすると右下にフローティングボタンを表示
- 上矢印アイコン（ArrowUp）を使用
- タップでフィードの先頭にスムーズスクロール
- フェードイン/フェードアウトのアニメーション付き
- プライマリカラー（青）の丸いボタン（48x48px）
- アクセシビリティラベル設定済み

**追加コード**:
```typescript
// State
const flatListRef = useRef<FlatList<TimelinePost>>(null);
const [showScrollToTop, setShowScrollToTop] = useState(false);
const scrollToTopOpacity = useRef(new Animated.Value(0)).current;
const SCROLL_THRESHOLD = 500;

// Handler
const handleScroll = useCallback(
  (event: NativeSyntheticEvent<NativeScrollEvent>) => {
    const offsetY = event.nativeEvent.contentOffset.y;
    const shouldShow = offsetY > SCROLL_THRESHOLD;
    // アニメーション処理...
  },
  [showScrollToTop, scrollToTopOpacity, SCROLL_THRESHOLD]
);

const scrollToTop = useCallback(() => {
  flatListRef.current?.scrollToOffset({ offset: 0, animated: true });
}, []);
```

**スタイル**:
```typescript
scrollToTopButton: {
  position: 'absolute',
  bottom: Spacing.xl,
  right: Spacing.lg,
  ...Shadows.md,
},
scrollToTopPressable: {
  width: 48,
  height: 48,
  borderRadius: 24,
  backgroundColor: Colors.primary,
  justifyContent: 'center',
  alignItems: 'center',
},
```

---

### 5. 多言語対応（i18n）の実装

**報告内容**: 国際化対応を実施

**実装内容**:

- `i18next`と`react-i18next`を使用した多言語対応基盤を構築
- 日本語（ja）と英語（en）の2言語をサポート
- デバイスの言語設定に応じて自動的に言語を切り替え

**追加ファイル**:

- `src/i18n/index.ts` - i18n設定と初期化
- `src/i18n/locales/en.json` - 英語翻訳ファイル
- `src/i18n/locales/ja.json` - 日本語翻訳ファイル

**対応画面**:

- ホーム画面（HomeScreen）
- 単語帳画面（WordbookScreen）
- 進捗画面（ProgressScreen）
- 設定画面（SettingsScreen）
- ライセンス画面（LicenseScreen）
- WordPopupモーダル
- その他共通コンポーネント

**使用方法**:

```typescript
import { useTranslation } from 'react-i18next';

const { t } = useTranslation();
// 使用例: t('home.title'), t('settings.language')
```

---

### 6. ATProtocol OAuth認証の正式実装

**目的**: `react-native-mmkv`などのネイティブモジュール依存によるエラーを解消し、安定したOAuth認証を提供。

**修正内容**:
- `@atproto/oauth-client`（コアライブラリ）への移行とカスタムアダプターの実装
- `react-native-mmkv`への依存を完全に排除し、`AsyncStorage`ベースのストレージアダプターを導入
- `expo-crypto`と`elliptic`を組み合わせたDPoP（Demonstrating Proof-of-Possession）対応の暗号化実装（`JoseKey`）
- `WebBrowser.openAuthSessionAsync`を使用した、より安定した認証フロー（ブラウザ起動からアプリ復旧までを一本化）
- 冗長なディープリンクリスナーの削除（コアライブラリとWebBrowserの組み合わせで簡素化）
- テストスイートの刷新：`authStore.test.ts`および`oauth-client`の初期化テストが正常に通過

---

### 7. ログイン画面の構成変更（OAuth一本化）

**目的**: ユーザー様のフィードバックに基づき、App Password認証を一旦廃止し、よりセキュアなOAuth認証のみのシンプルな構成に改善。

**修正ファイル**: `src/screens/LoginScreen.tsx`

**修正内容**:
- **App Password認証フォームの削除**: パスワード入力欄、ヘルプリンク、およびApp Password用のログインボタンを削除。
- **UIの簡素化**: ハンドル名入力と「Blueskyでログイン」ボタンのみの直感的なインターフェースに変更。
- **OAuthボタンのメイン化**: 画面中央に配置し、プライマリボタンとして設定。

---

### 8. OAuth認証エラー「Not implemented yet」の解消

**報告内容**: 実機（TestFlight）にてOAuth認証を試みると「Not implemented yet」エラーが発生する

**原因**:
- 暗号化の実装（`crypto-implementation.ts`）において、一部のバイナリ操作に環境依存（`atob`等）の関数を使用しており、Expo Go/Native環境で未実装エラーが発生していた。
- ダイジェスト（ハッシュ）計算時に、Uint8ArrayではなくBase64文字列を処理していたため計算結果が不正になっていた。
- `@atproto/oauth-client` が期待する `RuntimeImplementation` インターフェースのメソッド名が Core ライブラリのバージョンと乖離していた。

**修正ファイル**:
- `src/services/auth/crypto-implementation.ts`
- `src/services/auth/JoseKey.ts`

**修正内容**:
- **バイナリ処理の修正**: `expo-crypto` の `digest` メソッドを直接 Uint8Array で呼び出すように修正し、Base64/文字列変換によるバグと未実装エラーを解消。
- **インターフェースの適合**: インターフェース定義に合わせて `createKey` 等のメソッド名を修正。
- **鍵管理の強化**: `JoseKey` コンストラクタを拡張し、JWK（JSON Web Key）形式からの復元をサポートすることで、セッション再開時の安定性を向上。

---

### 9. OAuth認証後「Bad token scope」および「Authentication Required」エラーの解消

**報告内容**: OAuth認証自体は成功するが、認証後のAPI呼び出しで「Bad token scope」や「Authentication Required」エラーが発生する

**原因**:

1. **PDSとAuthorization Serverの混同**:
   - `bsky.social`はAuthorization Server（Entryway）であり、PDS（Protected Resource）ではない
   - ユーザーの実際のPDSは別のサーバー（例：`puffball.us-east.host.bsky.network`）
   - `customResolver`でハードコードされた`serviceEndpoint`が不正確だった

2. **DPoP-boundトークンとBskyAgentの非互換性**:
   - ATProtocol OAuthで取得するトークンはDPoP-bound（証明鍵に紐づけ）
   - `BskyAgent.resumeSession()`は従来のApp Password形式のトークンを想定
   - OAuth sessionの`fetchHandler`を使用してAPI呼び出しを行う必要があった

**修正ファイル**:
- `src/services/auth/oauth-client.ts`
- `src/services/bluesky/auth.ts`

**修正内容**:
- **PLC Directoryからの実DIDドキュメント取得**: `customResolver`を修正し、`https://plc.directory/{did}`からユーザーの本当のPDS URLを取得
- **キャッシュの修正**: Authorization Serverメタデータのみをキャッシュし、Protected Resourceキャッシュを削除
- **`setOAuthSession()`関数の導入**: OAuth sessionの`fetchHandler`を使用してAPI呼び出しを行うように変更
- **認証フローの修正**: `startOAuthFlow`と`resumeSession`で`setOAuthSession()`を使用

**成果**: **実機でのOAuthログイン成功を確認！**

---

### 10. 投稿フィードの翻訳漏れ修正

**報告内容**: 設定の言語を「English」にした時、投稿フィード内の以下の文章が英文に翻訳されていない
- 「たった今」等の投稿時間表示
- 「長押しで単語選択。ダブルタップで文章を選択 ※英文のみ」

**原因**: これらの文字列がハードコードされており、i18n翻訳システムを経由していなかった。

**修正ファイル**:
- `src/locales/en/common.json`
- `src/locales/ja/common.json`
- `src/locales/en/home.json`
- `src/locales/ja/home.json`
- `src/services/bluesky/feed.ts`
- `src/components/PostCard.tsx`

**修正内容**:

1. **相対時間の翻訳キー追加** (`common.json`):
```json
// en/common.json
"time": {
  "justNow": "Just now",
  "minutesAgo": "{{count}}m ago",
  "hoursAgo": "{{count}}h ago",
  "daysAgo": "{{count}}d ago"
}

// ja/common.json
"time": {
  "justNow": "たった今",
  "minutesAgo": "{{count}}分前",
  "hoursAgo": "{{count}}時間前",
  "daysAgo": "{{count}}日前"
}
```

2. **選択ヒントの翻訳キー追加** (`home.json`):
```json
// en/home.json
"selectionHint": "Long press to select word. Double tap to select sentence *English only"

// ja/home.json
"selectionHint": "長押しで単語選択。ダブルタップで文章を選択 ※英文のみ"
```

3. **`formatRelativeTime`関数の国際化対応** (`feed.ts`):
```typescript
export function formatRelativeTime(
  dateString: string,
  t?: TranslationFunction,
  locale: string = 'ja-JP'
): string {
  // 翻訳関数を受け取り、言語に応じた相対時間を返す
  if (diffSeconds < 60) {
    return t('common:time.justNow');
  } else if (diffMinutes < 60) {
    return t('common:time.minutesAgo', { count: diffMinutes });
  }
  // ...
}
```

4. **PostCardコンポーネントの更新** (`PostCard.tsx`):
```typescript
const { t, i18n } = useTranslation(['home', 'common']);

// 相対時間表示
{formatRelativeTime(post.createdAt, t, i18n.language)}

// 選択ヒント
{t('home:selectionHint')}
```

---

## テスト確認項目

- [ ] WordPopupモーダルのボタンエリアが透けていないこと
- [ ] ライセンス画面でYahoo! APIの名前とライセンスが正しく表示されること
- [ ] タブバーにアイコンのみ表示されること
- [ ] ホーム画面でスクロール後にTOPへ戻るボタンが表示されること
- [ ] TOPへ戻るボタンをタップでフィード先頭に戻ること
- [ ] **ログイン画面がハンドル名とOAuthボタンのみになっていること**
- [ ] **実機で「Blueskyでログイン」をタップし、正常に認証ブラウザが起動すること**
- [ ] **認証完了後、アプリに正常に戻りログインができること**
- [ ] **設定で言語を「English」に変更後、投稿時間が英語表示（"Just now", "5m ago"等）になること**
- [ ] **設定で言語を「English」に変更後、選択ヒントが英語表示になること**
- [ ] **句読点のない英語投稿で単語のダブルタップ・長押しが動作すること**
- [ ] **いいねボタンの隣にBookSearchアイコンが表示されること**
- [ ] **BookSearchアイコンをタップすると投稿全体でWordPopupが開くこと**
- [ ] **設定で言語を「English」に変更後、単語登録時のAlertが英語表示（"Success", "Word added!"等）になること**

---

### 11. 句読点なしの英文選択対応 & BookSearchボタン追加

**報告内容**:
- SNSの投稿はピリオド(.)や句読点(。)がない場合が多く、文章選択ができない
- ダブルタップは疲れるため、ワンタップで投稿全体を調べられるボタンが欲しい

**原因**:
- `PostCard.tsx`の英文判定ロジックで、末尾に`.!?`がないと英文として認識されなかった
- `splitIntoSentences()`は句読点なしのテキストを返すが、`isEnglishSentence`チェックで弾かれていた

**修正ファイル**:
- `src/components/PostCard.tsx`
- `src/locales/en/home.json`
- `src/locales/ja/home.json`

**修正内容**:

1. **句読点なしの英文選択対応** (`PostCard.tsx` 78-83行目):
```typescript
// 変更前
const hasEnglish = /[a-zA-Z]/.test(sentence);
const isEnglishSentence = hasEnglish && /[.!?]$/.test(sentence.trim());

// 変更後
const hasEnglish = /[a-zA-Z]/.test(sentence);
const hasTerminalPunctuation = /[.!?]$/.test(sentence.trim());
// 句読点がない場合でも、単一文章なら英文として扱う
const isOnlySentence = sentences.length === 1;
const isEnglishSentence = hasEnglish && (hasTerminalPunctuation || isOnlySentence);
```

2. **BookSearchボタンの追加** (`PostCard.tsx`):
```typescript
// アイコンのインポート追加
import { MessageCircle, Repeat2, Heart, BookSearch } from 'lucide-react-native';

// ハンドラー追加
const handleBookSearchPress = useCallback(() => {
  if (!onSentenceSelect) return;
  const fullText = post.text.trim();
  if (fullText) {
    setSelectedSentence(fullText);
    setSelectedWord(null);
    onSentenceSelect(fullText, post.uri, post.text);
  }
}, [post.uri, post.text, onSentenceSelect]);

// UIにボタン追加（いいねボタンの隣）
{onSentenceSelect && (
  <Pressable
    style={styles.bookSearchButton}
    onPress={handleBookSearchPress}
    hitSlop={{ top: 8, bottom: 8, left: 8, right: 8 }}
    accessible={true}
    accessibilityLabel={t('home:lookupPost')}
    accessibilityRole="button"
  >
    <BookSearch size={16} color={Colors.textSecondary} />
  </Pressable>
)}

// スタイル追加
bookSearchButton: {
  flexDirection: 'row',
  alignItems: 'center',
  padding: Spacing.xs,
},
```

3. **翻訳キーの追加**:
```json
// en/home.json
"lookupPost": "Look up post"

// ja/home.json
"lookupPost": "投稿を調べる"
```

**効果**:
- "oh yeah that would sell" のような句読点なしの投稿でも単語選択・文章選択が可能に
- BookSearchアイコンをワンタップするだけで投稿全体をWordPopupで調べられる

---

### 12. 開発モードでの不要なエラートースト非表示

**報告内容**: 単語の定義が見つからなかった場合やAPIレート制限時に、画面下部に警告トーストが表示される

**原因**: `AppError`クラスのコンストラクタで、開発モード（`__DEV__`）時にすべてのエラーを`console.error`で出力していた。これがReact Nativeのエラーオーバーレイとして表示されていた。

**修正ファイル**: `src/utils/errors.ts`

**修正内容**:

```typescript
// 変更前
if (__DEV__) {
  console.error(`[${this.timestamp}] ${code}: ${message}`, originalError);
}

// 変更後
// Skip logging for expected/handled cases that don't need console output
const silentErrors: ErrorCode[] = [
  ErrorCode.WORD_NOT_FOUND, // Normal case: word not in dictionary
  ErrorCode.RATE_LIMIT, // Expected when API limits are hit
  ErrorCode.RATE_LIMIT_EXCEEDED, // Expected when API limits are hit
];
if (__DEV__ && !silentErrors.includes(code)) {
  console.error(`[${this.timestamp}] ${code}: ${message}`, originalError);
}
```

**効果**:

- 辞書に単語が見つからない場合（`WORD_NOT_FOUND`）のエラートーストが非表示に
- APIレート制限エラー（`RATE_LIMIT`、`RATE_LIMIT_EXCEEDED`）のトーストが非表示に
- これらは正常な動作の一部であり、ユーザーに警告として表示する必要がないため

---

### 13. シェア機能の統合と画像付きBluesky投稿

**報告内容**: 進捗画面の「Blueskyに投稿」と「画像をシェア」ボタンを統合し、テキストと画像を一緒にシェアできるようにしてほしい

**修正ファイル**:
- `src/screens/ProgressScreen.tsx`
- `src/services/learning/session.ts`
- `src/locales/ja/progress.json`
- `src/locales/en/progress.json`

**実装内容**:

1. **シェアボタンの統合** (`ProgressScreen.tsx`):
   - 「Blueskyに投稿」と「画像をシェア」の2つのボタンを「シェアする」1つに統合
   - ログイン済みの場合はBlueskyに画像付き投稿、未ログインの場合は画像シェア

2. **画像付きBluesky投稿機能** (`session.ts`):
```typescript
// 画像アップロード関数
export async function uploadImageToBluesky(
  agent: BskyAgent,
  base64Data: string,
  mimeType: string = 'image/jpeg'
): Promise<{ blob: { $type: string; ref: { $link: string }; mimeType: string; size: number } }> {
  const uint8Array = new Uint8Array(Buffer.from(base64Data, 'base64'));
  const uploadResponse = await agent.uploadBlob(uint8Array, {
    encoding: mimeType,
  });
  // ...
}

// 画像付き投稿関数
export async function shareToBlueskyWithImage(
  agent: BskyAgent,
  wordsLearned: number,
  imageBase64: string,
  achievement?: string
): Promise<string> {
  const text = generateSessionPostText(wordsLearned, achievement);
  const facets = generateFacets(text);
  const uploadedImage = await uploadImageToBluesky(agent, imageBase64);
  // facetsとembed.imagesを含めて投稿
}
```

3. **ハッシュタグのリッチテキスト対応** (`session.ts`):
```typescript
export function generateFacets(text: string): Array<{
  index: { byteStart: number; byteEnd: number };
  features: Array<{ $type: string; tag: string }>;
}> {
  // ハッシュタグを検出してバイト位置を計算
  // Blueskyで#英語学習、#くもたんがクリック可能なリンクに
}
```

4. **OAuth認証対応**:
   - `agent.session?.did`（App Password）と`(agent as any).sessionManager?.did`（OAuth）の両方をサポート
   - DPoP-boundトークンでのAPI呼び出しに対応

5. **画像キャプチャの修正**:
   - React Nativeの`blob.arrayBuffer()`非対応問題を`Buffer.from(base64Data, 'base64')`で解決
   - PNG→JPEG変換で透過問題を回避
   - ViewShotの構造を修正し、四隅の白色表示を解消

**修正されたスタイル** (`ProgressScreen.tsx`):
```typescript
shareCardPreviewWrapper: {
  marginBottom: Spacing.lg,
  borderRadius: BorderRadius.lg,
  overflow: 'hidden',
},
shareCard: {
  backgroundColor: Colors.primary,
  padding: Spacing.xl,
  alignItems: 'center',
  // borderRadiusなし - ViewShotは矩形でキャプチャ
  // プレビューはshareCardPreviewWrapperのoverflow:hiddenで角丸表示
},
```

**翻訳キーの追加**:
```json
// ja/progress.json
"button": "シェアする"

// en/progress.json
"button": "Share"
```

**効果**:
- ワンタップでテキストと画像を一緒にBlueskyに投稿可能
- ハッシュタグがクリック可能なリンクとして表示
- 画像の四隅が白くならず、きれいな矩形画像として投稿

---

### 14. 単語登録ポップアップの翻訳対応

**報告内容**: 設定の言語選択でEnglishを選択した際、単語登録した時に表示されるポップアップ画面（Alert）が翻訳されていない

**原因**: `WordPopup.tsx`でAlertメッセージがハードコードされた日本語文字列を使用しており、i18n翻訳システムを経由していなかった。

**修正ファイル**: `src/components/WordPopup.tsx`

**修正内容**:

1. **`useTranslation`フックのインポート追加**:
```typescript
import { useTranslation } from 'react-i18next';
```

2. **コンポーネント内でフックを使用**:
```typescript
const { t } = useTranslation('wordPopup');
```

3. **ハードコードされたAlert文字列を翻訳キーに置換**:
```typescript
// 変更前
Alert.alert('情報', '登録する単語がありません');
Alert.alert('成功', '単語を追加しました！');
Alert.alert('エラー', '単語の追加に失敗しました');

// 変更後
Alert.alert(t('alerts.info'), t('alerts.noWordsToRegister'));
Alert.alert(t('alerts.success'), t('alerts.wordAdded'));
Alert.alert(t('alerts.error'), t('alerts.addFailed'));
```

**翻訳キー（既存）**:
```json
// en/wordPopup.json
"alerts": {
  "info": "Info",
  "success": "Success",
  "error": "Error",
  "noWordsToRegister": "No words to register",
  "wordsAdded": "Added {{count}} words",
  "wordsFailed": "({{count}} failed)",
  "wordAdded": "Word added!",
  "allWordsFailed": "Failed to add all words",
  "addFailed": "Failed to add word"
}

// ja/wordPopup.json
"alerts": {
  "info": "情報",
  "success": "成功",
  "error": "エラー",
  "noWordsToRegister": "登録する単語がありません",
  "wordsAdded": "{{count}}個の単語を追加しました",
  "wordsFailed": "({{count}}個は失敗)",
  "wordAdded": "単語を追加しました！",
  "allWordsFailed": "すべての単語の追加に失敗しました",
  "addFailed": "単語の追加に失敗しました"
}
```

**効果**:
- 設定で「English」を選択すると、単語登録時のAlertが英語で表示される（例: "Success" / "Word added!"）
- 設定で「日本語」を選択すると、従来通り日本語で表示される

---

### 15. 操作のヒント画面の追加

**目的**: ユーザーがアプリの使い方を確認できるヘルプ画面を提供

**実装内容**:

1. **ホーム画面のヘッダーアイコン変更** (`HomeScreen.tsx`):
   - `RefreshCw`（更新）アイコンを`Lightbulb`（電球）アイコンに変更
   - タップすると「操作のヒント」画面へ遷移

2. **Tips画面の新規作成** (`TipsScreen.tsx`):
```typescript
// 3つのヒントカードを表示
<TipCard
  icon={<Hand size={24} color={Colors.primary} />}
  title={t('wordSelection.title')}
  description={t('wordSelection.description')}
/>
<TipCard
  icon={<BookSearch size={24} color={Colors.primary} />}
  title={t('bookSearch.title')}
  description={t('bookSearch.description')}
/>
<TipCard
  icon={<Share2 size={24} color={Colors.primary} />}
  title={t('share.title')}
  description={t('share.description')}
/>
```

3. **設定画面への「操作のヒント」セクション追加** (`SettingsScreen.tsx`):
   - アカウントセクションの下に「ヘルプ」セクションを追加
   - 「操作のヒント」項目をタップするとTips画面へ遷移

4. **ナビゲーション追加** (`AppNavigator.tsx`):
```typescript
export type RootStackParamList = {
  // ...既存のルート
  Tips: undefined;  // 追加
};

<Stack.Screen
  name="Tips"
  component={TipsScreen}
  options={{
    headerShown: true,
    headerTitle: t('headers.tips'),
    // ...
  }}
/>
```

**追加ファイル**:
- `src/screens/TipsScreen.tsx` - 操作のヒント画面
- `src/locales/ja/tips.json` - 日本語翻訳
- `src/locales/en/tips.json` - 英語翻訳

**翻訳内容**:
```json
// ja/tips.json
{
  "header": "操作のヒント",
  "wordSelection": {
    "title": "単語選択",
    "description": "英単語を長押しすると、その単語を選択して単語帳に追加できます。"
  },
  "bookSearch": {
    "title": "投稿を調べる",
    "description": "投稿の下にある本のアイコン（BookSearch）をタップすると、投稿全体を選択して翻訳や意味を調べることができます。"
  },
  "share": {
    "title": "シェア機能",
    "description": "単語を選択した後、ポップアップの「シェア」ボタンをタップすると、画像付きでBlueskyに投稿をシェアできます。学習の記録を友達と共有しましょう。"
  }
}

// en/tips.json
{
  "header": "Tips",
  "wordSelection": {
    "title": "Word Selection",
    "description": "Long press on an English word to select it and add it to your vocabulary."
  },
  "bookSearch": {
    "title": "Look Up Post",
    "description": "Tap the book icon (BookSearch) below a post to select the entire post for translation or looking up meanings."
  },
  "share": {
    "title": "Share Feature",
    "description": "After selecting a word, tap the 'Share' button in the popup to share the post to Bluesky with an image. Share your learning progress with friends."
  }
}
```

**設定画面の翻訳追加**:
```json
// ja/settings.json
"sections": {
  "tips": "ヘルプ",
  // ...
},
"tips": {
  "title": "操作のヒント",
  "subtitle": "アプリの使い方を確認する"
}

// en/settings.json
"sections": {
  "tips": "Help",
  // ...
},
"tips": {
  "title": "Usage Tips",
  "subtitle": "Learn how to use the app"
}
```

**効果**:
- ホーム画面のヘッダーの電球アイコンから操作のヒントにアクセス可能
- 設定画面の「ヘルプ」セクションからも操作のヒントにアクセス可能
- 単語選択、BookSearchアイコン、シェア機能の3つの使い方を説明

---

### 16. 投稿カードのレイアウト変更（Bluesky風）

**目的**: Blueskyの投稿レイアウトを参考に、投稿文がアバターの右側へ配置されるよう変更

**修正ファイル**: `src/components/PostCard.tsx`

**修正内容**:

1. **投稿内ヒント文の削除**:
   - 各投稿カードの下部に表示されていた「長押しで単語選択。ダブルタップで文章を選択 ※英文のみ」のヒント文を削除
   - 操作のヒントは専用のTips画面で確認できるため、投稿カード内での表示は不要と判断

2. **横並びレイアウトの採用**:
   - アバターを左側に固定し、右側へ著者情報・投稿文・メトリクスを配置
   - Blueskyの投稿表示と同様のレイアウトへ変更

3. **スタイル変更**:

```typescript
// 新しいレイアウト構造
postLayout: {
  flexDirection: 'row',
  alignItems: 'flex-start',
},
avatar: {
  width: 42,        // 48 から 42 に縮小
  height: 42,
  borderRadius: 21,
  backgroundColor: Colors.skeleton,
  marginRight: Spacing.md,
},
contentColumn: {
  flex: 1,
},
authorRow: {
  flexDirection: 'row',
  alignItems: 'center',
  marginBottom: Spacing.sm,  // Spacing.md から Spacing.sm に変更
},
metricsRow: {
  flexDirection: 'row',
  paddingTop: Spacing.sm,
  gap: Spacing.xl,
  // borderTopWidth と borderTopColor を削除
},
```

4. **JSX構造の変更**:

```typescript
<Pressable style={styles.container}>
  <View style={styles.postLayout}>
    {/* Avatar column - 左側固定 */}
    <Image style={styles.avatar} />

    {/* Content column - 右側に展開 */}
    <View style={styles.contentColumn}>
      <View style={styles.authorRow}>...</View>
      <View style={styles.content}>...</View>
      <View style={styles.metricsRow}>...</View>
    </View>
  </View>
</Pressable>
```

**効果**:

- Blueskyの投稿表示と同様のレイアウトで、ユーザーが見慣れた形式を採用
- アバターが左側に固定され、投稿内容が右側へ配置されることで視認性が向上
- ヒント文の削除により、各投稿カードがよりコンパクトな表示へ

---

### 17. いいね機能の実装

**目的**: ユーザーが投稿に「いいね」を付けたり取り消したりできるようにする

**修正ファイル**:
- `src/services/bluesky/feed.ts`
- `src/types/bluesky.ts`
- `src/components/PostCard.tsx`
- `src/screens/HomeScreen.tsx`
- `src/screens/ThreadScreen.tsx`
- `src/locales/ja/home.json`
- `src/locales/en/home.json`

**実装内容**:

1. **API関数の追加** (`feed.ts`):
```typescript
// いいねを付ける
export async function likePost(uri: string, cid: string): Promise<Result<{ uri: string }, AppError>> {
  // セッション確認、レート制限チェック
  const agent = getAgent();
  const response = await agent.like(uri, cid);
  return { success: true, data: { uri: response.uri } };
}

// いいねを取り消す
export async function unlikePost(likeUri: string): Promise<Result<boolean, AppError>> {
  // セッション確認、レート制限チェック
  const agent = getAgent();
  await agent.deleteLike(likeUri);
  return { success: true, data: true };
}
```

2. **型定義の更新** (`bluesky.ts`):
```typescript
// PostViewer型を追加
export interface PostViewer {
  like?: string; // いいねレコードのURI（いいね済みの場合）
  repost?: string; // リポストレコードのURI（リポスト済みの場合）
}

// TimelinePostにcidとviewerを追加
export interface TimelinePost {
  uri: string;
  cid: string;  // 追加
  text: string;
  author: { ... };
  createdAt: string;
  likeCount?: number;
  repostCount?: number;
  replyCount?: number;
  embed?: PostEmbed;
  viewer?: PostViewer;  // 追加
}
```

3. **PostCardのいいねUI** (`PostCard.tsx`):
```typescript
// いいね状態の管理
const [isLiked, setIsLiked] = useState(!!post.viewer?.like);
const [likeCount, setLikeCount] = useState(post.likeCount ?? 0);
const [isLikeLoading, setIsLikeLoading] = useState(false);

// いいねボタンハンドラー（オプティミスティックUI）
const handleLikePress = useCallback(() => {
  if (isLikeLoading || !onLikePress) return;
  setIsLikeLoading(true);
  const newIsLiked = !isLiked;
  setIsLiked(newIsLiked);
  setLikeCount((prev) => newIsLiked ? prev + 1 : Math.max(0, prev - 1));
  onLikePress(post, newIsLiked);
  setTimeout(() => setIsLikeLoading(false), 500);
}, [isLiked, isLikeLoading, onLikePress, post]);

// いいねボタンUI
<Pressable
  style={styles.metricItem}
  onPress={handleLikePress}
  disabled={isLikeLoading}
  accessibilityLabel={isLiked ? t('home:unlike') : t('home:like')}
>
  <Heart
    size={14}
    color={isLiked ? Colors.error : Colors.textSecondary}
    fill={isLiked ? Colors.error : 'transparent'}
  />
  <Text style={[styles.metricText, isLiked && styles.likedText]}>
    {likeCount}
  </Text>
</Pressable>
```

4. **HomeScreenのいいね処理** (`HomeScreen.tsx`):
```typescript
import { likePost, unlikePost } from '../services/bluesky/feed';

const handleLikePress = useCallback(
  async (post: TimelinePost, shouldLike: boolean) => {
    try {
      if (shouldLike) {
        await likePost(post.uri, post.cid);
      } else {
        if (post.viewer?.like) {
          await unlikePost(post.viewer.like);
        }
      }
    } catch (error) {
      if (__DEV__) {
        console.error('Like operation failed:', error);
      }
    }
  },
  []
);

// PostCardにonLikePressを渡す
<PostCard
  post={post}
  onLikePress={handleLikePress}
  // ...
/>
```

5. **ThreadScreenの対応** (`ThreadScreen.tsx`):
- `toTimelinePost`関数に`cid`と`viewer`を追加
- スレッド内の投稿（メイン、親、返信）すべてでいいね状態を表示

6. **翻訳キーの追加**:
```json
// en/home.json
"like": "Like",
"unlike": "Unlike"

// ja/home.json
"like": "いいね",
"unlike": "いいねを取り消す"
```

**効果**:
- タイムラインの投稿でハートアイコンをタップしていいねを付けられる
- いいね済みの投稿は赤いハートで表示
- オプティミスティックUI更新により、即座にUI反映（API完了を待たない）
- スレッド画面でもいいね状態が表示される

---

## 次のステップ

1. 新しいビルドを作成（`eas build --profile production --platform ios`）
2. TestFlightに配信
3. ベータテスターに再テストを依頼
