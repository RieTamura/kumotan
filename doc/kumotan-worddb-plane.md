kumotan 単語データ外部管理・配信設計書

1. 概要アプリ「kumotan」の本体サイズを軽量化し、かつオフラインでの利用を両立させるため、単語データをアプリ本体から切り離して外部管理（External Hosting）する。初回起動時にデータを自動ダウンロードし、ローカルデータベースを構築する仕組みを定義する。

2. 目的アプリサイズの削減: 数万件に及ぶ単語データをアプリに同梱せず、インストールを高速化する。データ更新の柔軟性: アプリのアップデート（ストア審査）を通さずに、単語の修正や追加を反映可能にする。オフライン体験の維持: 初回ダウンロード後は通信不要で全ての単語帳機能を利用可能にする。

3. システムアーキテクチャ
  3.1 リポジトリ構成アプリリポジトリ (kumotan)アプリケーションのUI、ロジック、DBアクセス層を管理。データ配信リポジトリ (例: kumotan-data)単語データファイル（SQLite, CSV, JSON等）を管理。GitHub Pages を有効化し、静的ファイルサーバーとして機能させる。
  
  3.2 データ配信URL (例)https://rietamura.github.io/kumotan-data/v1/words.db.gz

4. ワークフロー詳細
  4.1 初回起動時の動作初期チェック: 端末内の所定のフォルダ（Application Support Directory等）にDBファイルが存在するか確認。ダウンロード: 存在しない場合、GitHub PagesのURLへHTTP GETリクエストを送信し、データをダウンロード。プログレス表示: ユーザーに「データの準備中（%表示）」などのUIを提示。解凍・配置: 圧縮ファイル（.gz等）を解凍し、DBエンジンが読み込めるパスへ配置。完了フラグ: 端末の設定領域（SharedPreferences等）に is_initial_setup_completed: true を保存。
  
  4.2 通常起動（2回目以降）フラグ確認: 完了フラグがあるため、ダウンロード工程をスキップ。DB接続: ローカルに配置済みのDBファイルを開き、即座に検索・学習を開始。

5. 技術選定のポイント
  5.1 配信フォーマット（推奨：SQLite事前ビルド）手法: PC側でデータを流し込んだ .db ファイルを作成し、それを圧縮して配布。利点: スマホ側で INSERT 文を何万回も実行する必要がなく、ファイルを配置するだけでセットアップが完了する（極めて高速）。
  
  5.2 配信インフラ（GitHub Pages）利点: 無料、高可用性、CORS対応済み。管理: フォルダ構造（v1/, v2/）を作ることで、将来的なデータのメジャーアップデートにも対応可能。

6. 実装上の留意点
  通信環境の考慮: Wi-Fi接続を推奨するメッセージの表示や、タイムアウト時のリトライロジックを実装する。整合性チェック: ダウンロードしたファイルが破損していないか、ハッシュ値等で確認する仕組みがあるとより安全。バージョン管理: アプリ側で「現在のデータバージョン」を記録し、GitHub上の最新バージョンと不一致がある場合のみ更新を促す仕組み。

7. 今後のロードマップ
  データリポジトリの構築: GitHub Pages上でダミーファイルが取得できることを確認。ダウンロード機能の実装: アプリからHTTPリクエストとファイル保存の実装。DB切り替え: 同梱データ参照から、外部保存パスの参照へのロジック変更。